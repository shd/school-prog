\documentclass[12pt,a4paper,oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{cmll}
\usepackage[left=1.5cm,right=1.5cm,top=1.5cm,bottom=2cm,bindingoffset=0cm]{geometry}
\usepackage{bnf}
\newcommand{\s}[1]{\texttt{#1}}
\usepackage{proof}

\begin{document}
\theoremstyle{definition}
\newtheorem{definition}{Определение}[section]

\theoremstyle{lemma}
\newtheorem{lemma}{Лемма}[section]

\section{Перестановки}

Напомним классическое определение. Перестановка --- биективная функция, отображающая 
множество $X$ на себя.
Однако, в данной главе в качестве множества $X$ мы будем рассматриваеть только 
множества целых чисел от $0$ до $n-1$. Соответственно, определение становится таким:

\begin{definition}
Если $\pi: \overline{0,n-1} \rightarrow \overline{0,n-1}$ является биективной,
то она --- \emph{перестановка}.
\end{definition}

\noindent Обозначим множество всех перестановок чисел $0,1,\dots,n-1$ за $S_n$.

\noindent Традиционный способ задания перестановок --- с помощью <<двухэтажной>> записи 
(обычно называемой \emph{подстановкой}):

$$
\left(\begin{array}{ccccc}
0 & 1 & 2 & \dots & n-1\\
\pi(0) & \pi(1) & \pi(2) & \dots & \pi(n-1)
\end{array}\right)
$$

Однако, верхняя строчка в перестановках всегда одинакова, поэтому мы будем её опускать,
и записывать только нижнюю часть: $[\pi(0);\pi(1);\dots;\pi(n-1)]$. Такая запись не является
канонической для математики, но зато она очень удобна для наших целей.
Например, перестановка пяти элементов, меняющая местами 0 и 1 (и оставляющая на месте 2, 3 и 4), 
будет задаваться нами так: $[1;0;2;3;4]$

Также введём специальное обозначение для количества переставляемых элементов.

\begin{definition}
Пусть $\pi: \overline{0,n-1} \rightarrow \overline{0,n-1}$, \emph{мощностью}
перестановки $\pi$ будем называть мощность множества отправления (прибытия).
Будем обозначать эту мощность как $|\pi|$.
Например, $|[0;2;1]| = 3$. 
\end{definition}

Также давайте введём понятие \emph{префикса} перестановки: 

\begin{definition}
Пусть $[a_0; a_1; \dots; a_{n-1}]$ --- некоторая перестановка.
Тогда последовательность чисел $[a_0; a_1; \dots; a_{k-1}]$ при $k \le n$~--- 
\emph{префикс} (начало) перестановки. В частности, префиксами
являются пустая последовательность чисел $[]$ и вся исходная перестановка.
\end{definition}

Легко заметить, что если последовательность чисел $[a_0; a_1; \dots; a_{k-1}]$~---
последовательность попарно различных чисел из диапазона от $0$ до $n-1$:
$$0 \le k \le n, \quad 0 \le a_i < n, \quad a_p \ne a_q \mbox{ при } q \ne q$$
то такая последовательность
может быть продолжена до полной перестановки, причём $(n-k)!$ способами.

\subsection{Лексикографический порядок}

Лексикографический порядок ещё называют словарным. Правила тут должны быть
хорошо известны: чтобы сравнить два слова, нужно сравнить у них первые различающиеся 
буквы в одной и той же позиции. 
Например, слово \emph{РУКА} идёт раньше в словаре, чем слово \emph{РЫБА}, поскольку во второй
позиции первого слова --- буква \emph{У}, а у второго слова --- буква \emph{Ы}, идущая позже.

\begin{definition}
Обозначим за $|S|$ длину слова $S$, и за $S_i$ --- символ строки номер $i$. Нумерацию по
традиции будем вести с $0$.
Например, если $S = \texttt{абрикос}$, то $|S|=7$ и $S_4=\texttt{к}$.
\end{definition}

\begin{definition}
Пусть даны два слова ($S$ и $T$) одинаковой длины.
Слово $S$ меньше слова $T$ (обозначим это отношение за $S \prec T$), 
если существует индекс $i$, что:
$$S_0 = T_0, \quad S_1 = T_1, \quad \dots, \quad S_{i-1} = T_{i-1}, \quad \mbox{но } S_i < T_i$$
\end{definition}

\noindent Данное условие можно обобщить и на случай слов разной длины.
\begin{definition}
$S \prec T$, если:
\begin{enumerate}
\item Существует индекс $i$: $S_i < T_i$, но для всех индексов $j$, $0 \le j < i$, выполнено $S_j = T_j$.
\item $|S| < |T|$, и для всех индексов $i$, $0 \le i < |S|$, выполнено $S_i=T_i$
\end{enumerate}
\end{definition}

\noindent Мы легко могли бы написать функцию сравнения двух списков:

\begin{verbatim}
let rec is_less a b =
    match (a,b) with
        (a1::ax,b1::bx) when a1 < b1 -> true
      | (a1::ax,b1::bx) when a1 = b1 -> is_less ax bx
      | _ -> false
\end{verbatim}

Но в этом коде нет необходимости, поскольку операции сравнения определены
и для списков, причём списки сравниваются лексикографически.
Например, сравнения \verb![1;2;3] < [2;1;3]!, \verb![1] < [2;1]! и \verb![] < [9;7;10]! вернут \verb!true!.

\subsubsection{Упорядочение перестановок}

Определим порядок на перестановках как лексикографический:

\begin{definition}
Перестановку $\pi$ назовём меньшей перестановки $\sigma$ (и обозначим это
как $\pi\prec\sigma$, если найдётся такой индкес $p$, что:
\begin{enumerate}
\item $\pi(0) = \sigma(0),\quad\pi(1) < \sigma(1),\quad\dots\quad,\pi(p-1)=\sigma(p-1)$
\item $\pi(p) < \sigma(p)$
\end{enumerate}
\end{definition}

\noindent В частности, $p=0$ также можно рассматривать: $[0;1]\prec[1;0]$.

\subsection{Несколько фактов о лексикографическом порядке на перестановках}

\begin{lemma}
Рассмотрим перестановки равной мощности $\pi$ и $\sigma$ (пусть для определённости $\pi\preceq\sigma$), 
такие, что некоторый префикс этих перестановок совпадает:
$$\pi(0) = \sigma(0),\quad \pi(1) =\sigma(1),\quad\dots\quad, \pi(p-1) = \sigma(p-1)$$

Тогда для того, чтобы перестановка $\tau$ находилась в лексикографическом порядке
между $\pi$ и $\sigma$ ($\pi\preceq\tau\preceq\sigma$), необходимо, чтобы и она имела
тот же префикс:
$$\tau(0) = \pi(0),\quad \tau(1) = \pi(1) ,\quad\dots,\quad \tau(p-1) = \pi(p-1)$$
\end{lemma}

\begin{proof}
Докажем от противного. Пусть это не так --- тогда найдём минимальный
отличающийся элемент перестановки --- то есть, такой $k$, что $k<p$ и выполнены 
следующие равенства и неравенства:
\begin{enumerate}
\item $\tau(0) = \pi(0) = \sigma(0),\quad \tau(1) = \pi(1) =\sigma(1),\quad\dots,\quad \tau(k-1) = \pi(k-1) = \sigma(k-1)$
\item $\tau(k)\ne\pi(k)=\sigma(k)$
\end{enumerate}
Воспользовавшись определением сравнения перестановок, легко убедиться, 
что в этом случае перестановка $\tau$ либо меньше как
$\pi$, так и $\sigma$ (если $\tau(k) < \pi(k)$), либо больше 
(если $\tau(k) > \pi(k)$). В любом случае мы получаем противоречие с условием.
\end{proof}


\begin{lemma}
Рассмотрим множество перестановок длины $n$ с префиксом $[a_0; a_1; \dots; a_{p-1}]$:
$$P = \{\pi\in S_n | \pi(0)=a_0 \with \pi(1)=a_1 \with\dots\with \pi(p-1)=a_{p-1}\}$$
где $a_i$ --- какие-то заранее заданные значения.

Обозначим минимальную и максимальную перестановки в множестве за $\rho$ и $\sigma$:
$$\rho = \min P, \quad \sigma = \max P$$
Тогда справедливо следующее:
$$\rho(p) < \rho(p+1) < \dots < \rho(n-1)$$
$$\sigma(p) > \sigma(p+1) > \dots > \sigma(n-1)$$
\end{lemma}

\begin{proof}
Утверждение леммы легко получить, проверив определение сравнения: в самом деле,
пусть дана перестановка $\tau$. Чтобы получить $\tau\prec\rho$, необходимо, чтобы
нашёлся такой индекс $t$, что $\tau(t) < \rho(t)$ и $\tau(q) = \rho(t)$ если $q < t$.

Возможно ли, чтобы $t = p$? Нет, поскольку $\rho(p)$ --- минимальный из всех доступных
для изменения элементов перестановки. Значит, $\tau(p) = \rho(p)$. Но, может,
$t = p+1$? Также нет, поскольку $\rho(p+1)$ --- минимум из оставшихся элементов;
значит, $\tau(p+1) = \rho(p+1)$, и так далее. В итоге мы придём к выводу, что 
$\tau = \rho$ --- что противоречит предположению.

Аналогично можно показать и утверждение про $\sigma$.
\end{proof}

\begin{lemma}
Рассмотрим множество перестановок $S_n$ и два префикса перестановок одинаковой
длины: $a$ и $b$ ($|a| = |b| \le n$), причём $a \prec b$. Тогда все перестановки 
из $S^a_n$ меньше перестановок из $S^b_n$: $$\forall x\in S^a_n\quad\forall y\in S^b_n\quad x \prec y$$
\end{lemma}

\begin{proof}
Очевидно из того, что сравнение перестановок идёт слева направо: сперва мы сравниваем
префиксы, и приступаем к сравнению <<послепрефиксной>> части перестановок только
если префиксы равны. А поскольку префикс $a$ меньше префикса $b$ ($a \prec b$), то и 
перестановки из $S^a_n$ меньше перестановок из $S^b_n$.
\end{proof}

\subsection{Построение следующей перестановки по перестановке из $S_n$}

Анализ вышеуказанных лемм позволяет нам предложить алгоритм построения следующей
перестановки. Пусть дана перестановка $\pi = [a_0; a_1; \dots; a_{n-1}]$. Тогда:
\begin{enumerate}
\item Рассмотрим такое минимальное число $p$, что 
$$a_p < a_{p+1} < a_{p+2} < \dots < a_{n-1}$$
То есть, иными словами, убывающая последовательность имеет максимально возможную
длину. 
\item Среди чисел $a_p, a_{p+1} \dots a_{n-1}$ найдём минимальное, б\'{o}льшее $a_{p-1}$ --- 
пусть это $a_t$.
\item Рассмотрим префикс $[a_0; a_1; \dots; a_{p-2}; a_t]$ --- а оставшиеся
<<послепрефиксные>> элементы перестановки расположим по возрастанию. Это и будет 
искомая следующая перестановка.
\end{enumerate}


\subsection{Сопоставление факториального числа и перестановки}

Рассмотрим перестановки мощности $n$. Заметим, что в силу лексикографического порядка 
перестановок, все 


Однако, если мощности различаются, всё становится сложнее ---

\begin{definition}Пусть $|\sigma| < |\pi|$, и пусть $k = |\pi|-|\sigma|$. То есть
перестановка $\pi$ мощнее перестановки $\sigma$ на $k$ элементов. 
Назовём перестановку $\sigma$ частным случаем перестановки $\pi$, если выполнены сразу следующие два условия:
\begin{enumerate}
\item $\pi_0 = 0, \pi_1 = 1, \dots, \pi_{k-1} = k-1$
\item $\pi_k = \sigma_0, \pi_{k+1} = \sigma_1, \dots, \pi_{k+|\sigma|-1} = \sigma{|\sigma|-1}$
\end{enumerate}
\end{definition}

Столь сложное определение вызвано тем, что сравниваем перестановки мы справа налево
(наименее значимый разряд --- крайний справа), однако, нумеруем мы разряды справа налево
(элемент $0$ --- крайний слева). 

Поэтому нам нужно выровнять перестановки для правильного сравнения.

\subsection{Факториальные числа}

Если же все буквы одинаковы, то меньше то слово, которое короче (слово \emph{БАЛ} идёт раньше 
слова \emph{БАЛКА}). 

\end{document}